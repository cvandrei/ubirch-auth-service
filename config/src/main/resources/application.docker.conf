include "application.base.conf"

# these environment variables have to be defined
# https://ubirch.atlassian.net/wiki/display/UBD/ubirch+Docker+Env+Vars
# * SERVICE_IP
# ** IP adresse service should bind to, e.g. 127.0.0.1 or 0.0.0.0
# * SERVICE_PORT
# ** port which service should use, e.g. 8080
# * AKKA_ACTOR_TIMEOUT
# ** timeout of Akka Actors in seconds
# * AKKA_NUMBER_OF_WORKERS
# ** number of Akka Actor workers
# * REDIS_HOST
# ** Redis host url
# * REDIS_PORT
# ** port Redis is listening on
# * REDIS_PASSWORD
# ** optional password for Redis
# * MONGO_USER
# ** user name required to access MongoDB
# * MONGO_PASSWORD
# ** password required to access MongoDB
# * MONGO_PORT
# ** MongoDB port
# * MONGO_OPTIONS
# ** MongoDB connection options
# * MONGO_HOST_1
# ** MongoDB url of host_1

akka {
  loglevel = INFO
}

rediscala {
  loglevel = "INFO"
  rediscala-client-worker-dispatcher {
    mailbox-type = "akka.dispatch.SingleConsumerOnlyUnboundedMailbox"
    # Throughput defines the maximum number of messages to be
    # processed per actor before the thread jumps to the next actor.
    # Set to 1 for as fair as possible.
    throughput = 512
  }
}

ubirchAuthService {

  interface = ${SERVICE_IP}
  port = ${SERVICE_PORT}

  akka {
    actorTimeout = 90
    actorTimeout = ${?AKKA_ACTOR_TIMEOUT} // seconds
    numberOfWorkers = 2
    numberOfWorkers = ${?AKKA_NUMBER_OF_WORKERS}
  }

}

ubirch {

  oidcUtils {
    redis {
      updateExpiry = 1800 // seconds (30 minutes)
    }
  }

  redisUtil {
    host = ${REDIS_HOST}
    port = ${REDIS_PORT}
    password = ${?REDIS_PASSWORD}
  }

  mongo {

    userPassword = ${MONGO_USER}":"${MONGO_PASSWORD}
    portAndOption = ${MONGO_PORT}"/user-service?"${MONGO_OPTIONS}

    // for uri formats see: https://docs.mongodb.com/manual/reference/connection-string/
    host1 = "mongodb://"${ubirch.mongo.userPassword}"@"${MONGO_HOST_1}":"${ubirch.mongo.portAndOption}

    hosts = ${ubirch.mongo.host1}

  }

}

ubirchUserService {
  redisUtil {
    host = ${REDIS_HOST}
    port = ${REDIS_PORT}
    password = ${?REDIS_PASSWORD}
  }

  mongo {

    userPassword = ${MONGO_USER}":"${MONGO_PASSWORD}
    portAndOption = ${MONGO_PORT}"/user-service?"${MONGO_OPTIONS}

    // for uri formats see: https://docs.mongodb.com/manual/reference/connection-string/
    host1 = "mongodb://"${ubirch.mongo.userPassword}"@"${MONGO_HOST_1}":"${ubirch.mongo.portAndOption}

    hosts = ${ubirch.mongo.host1}

    collection {
      context = "context"
      user = "user"
      group = "group"
    }

  }

}